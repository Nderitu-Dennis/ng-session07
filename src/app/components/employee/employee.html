<div class="m-2 p-4 bg-dark border rounded">
  <div class="bg-secondary col-12 col-md-10 col-lg-8 mx-auto pt-3 pb-3 rounded">
    <form
      #empForm="ngForm"
      (ngSubmit)="save(empForm)"
      [class.bg-warning-subtle]="empForm.pristine"
      class="bg-primary-subtle col-12 col-md-8 mx-auto p-4 border rounded shadow-sm"
    >
      <h2 class="mb-4">Employee Form</h2>

      <div class="mb-3">
        <label class="form-label">Name</label>
        <input
          type="text"
          name="name"
          class="form-control"
          [(ngModel)]="employeeObj.name"
          #name="ngModel"
          required
          minlength="3"
          [class.is-invalid]="name.invalid && (name.dirty || name.touched)"
        />

        @if (name.invalid && (name.dirty || name.touched)) {
          <div class="text-danger small">
            @if (name.errors?.['required']) {
              <span>Name is required.</span>
            }
            @if (name.errors?.['minlength']) {
              <span>Minimum 3 characters required.</span>
            }
          </div>
        }

        <!-- 
        1. invalid- true if any validation rule (like required or minlength) is failing.
        2. touched	- true if the user clicked into the field and then blurred (left) it. great 
        for showing errors only after the user has visited the field.
        3. dirty- true if the user has actually changed the value of the input. If they just clicked 
        in and out without typing, it is touched but not dirty.
        4. name.errors:  an object that holds all the current validation failures(which rule was broken). -->
      </div>

      <div class="mb-3">
        <label class="form-label">Email</label>
        <input
          type="email"
          name="email"
          class="form-control"
          [(ngModel)]="employeeObj.email"
          #email="ngModel"
          required
          email
          [class.is-invalid]="email.invalid && (email.dirty || email.touched)"
        />

        @if (email.invalid && (email.dirty || email.touched)) {
          <div class="text-danger small">
            @if (email.errors?.['required']) {
              <span>Email is required.</span>
            }
            @if (email.errors?.['email']) {
              <span>Please enter a valid email address.</span>
            }
          </div>
        }
      </div>

      <div class="mb-3">
        <label class="form-label">Phone</label>
        <input
          type="tel"
          name="phone"
          class="form-control"
          [(ngModel)]="employeeObj.phone"
          #phone="ngModel"
          required
          pattern="^[0-9]{10}$"
          [class.is-invalid]="phone.invalid && (phone.dirty || phone.touched)"
        />

        @if (phone.invalid && (phone.dirty || phone.touched)) {
          <div class="text-danger small">
            @if (phone.errors?.['required']) {
              <span>Phone number is required.</span>
            }
            @if (phone.errors?.['pattern']) {
              <span>Enter a valid 10-digit number.</span>
            }
          </div>
        }
      </div>

      <button type="submit" class="btn btn-primary w-100 m-1" [disabled]="empForm.invalid">
        {{ editIndex !== null ? 'Update Employee' : 'Submit' }}
      </button>
    </form>
  </div>

  <!-- employee details table -->

  <div class="bg-secondary col-12 col-md-10 col-lg-8 mx-auto mt-3 rounded">
    <div class="h1 m-3">Employee Details</div>

    <div class="table-responsive p-2">
      <table class="table table-bordered table-striped table-hover align-middle table-sm">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          @for (emp of employees; track emp; let i = $index) {
            <tr>
              <td>{{ emp.name }}</td>
              <td>{{ emp.email }}</td>
              <td>{{ emp.phone }}</td>
              <td>
                <button class="btn btn-outline-danger me-1" (click)="deleteEmployee(i)">
                  Delete
                </button>
                <button class="btn btn-outline-secondary" (click)="onEdit(emp, i)">Update</button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="4" class="text-center text-bg-danger">No employees found</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
